#!/usr/bin/env bash

set -e

# Wrapper script for git-secret reveal that automatically fixes permissions
# on SSH private keys after revealing

show_help() {
    cat << EOF
Usage: reveal-secrets [OPTIONS] [git-secret-args...]

Wrapper script for git-secret reveal that automatically fixes permissions
on SSH private keys after revealing.

Options:
    -h, --help    Show this help message and exit

Any additional arguments are passed directly to 'git secret reveal'.

Examples:
    reveal-secrets              # Reveal all secrets
    reveal-secrets -f           # Force reveal (overwrite existing files)
    reveal-secrets file.txt     # Reveal specific file
EOF
}

# Parse arguments
case "${1:-}" in
    -h|--help)
        show_help
        exit 0
        ;;
esac

echo ">> Revealing secrets..."
git secret reveal "$@"

echo ">> Setting correct permissions on SSH private keys..."
chmod 600 ~/.ssh/pems/*.pem 2>/dev/null || true

echo ">> Done!"
