#!/bin/bash

PROFILE_LAPTOP="laptop";
PROFILE_SINGLE="single";
PROFILE_SINGLE_INVERTED="single-inverted";
PROFILE_DUAL="dual";
PROFILE_DUAL_INVERTED="dual-inverted";
PROFILE_VIRTUAL="virtual";
PROFILE_HDMI="hdmi"

XRANDR_DISPLAY_PROFILE=$1

killall -q polybar

echo "Applying display profile: $XRANDR_DISPLAY_PROFILE"

# Reload Xresources
xrdb ~/.Xresources

if [[ "$XRANDR_DISPLAY_PROFILE" == "$PROFILE_LAPTOP" ]]; then
    xrdb -merge ~/.Xresources.laptop

    # Xresources.DPI * 1024
    echo "Xft/DPI 196608" > ~/.xsettingsd
    
    bash ~/.screenlayout/laptop.sh
fi

if [[ "$XRANDR_DISPLAY_PROFILE" == "$PROFILE_SINGLE" ]]; then
    xrdb -merge ~/.Xresources.asus

    # Xresources.DPI * 1024
    echo "Xft/DPI 98304" > ~/.xsettingsd
    
    bash ~/.screenlayout/asus_single.sh
fi

if [[ "$XRANDR_DISPLAY_PROFILE" == "$PROFILE_SINGLE_INVERTED" ]]; then
    xrdb -merge ~/.Xresources.asus

    # Xresources.DPI * 1024
    echo "Xft/DPI 98304" > ~/.xsettingsd

    bash ~/.screenlayout/asus_single_inverted.sh
fi

if [[ "$XRANDR_DISPLAY_PROFILE" == "$PROFILE_DUAL" ]]; then
    xrdb -merge ~/.Xresources.asus

    # Xresources.DPI * 1024
    echo "Xft/DPI 98304" > ~/.xsettingsd

    bash ~/.screenlayout/asus_dual.sh
fi

if [[ "$XRANDR_DISPLAY_PROFILE" == "$PROFILE_DUAL_INVERTED" ]]; then
    xrdb -merge ~/.Xresources.asus

    # Xresources.DPI * 1024
    echo "Xft/DPI 98304" > ~/.xsettingsd

    bash ~/.screenlayout/asus_dual_inverted.sh
fi

if [[ "$XRANDR_DISPLAY_PROFILE" == "$PROFILE_VIRTUAL" ]]; then
    xrdb -merge ~/.Xresources.asus

    # Xresources.DPI * 1024
    echo "Xft/DPI 98304" > ~/.xsettingsd
    
    bash ~/.screenlayout/virtual.sh
fi

if [[ "$XRANDR_DISPLAY_PROFILE" == "$PROFILE_HDMI" ]]; then
    xrdb -merge ~/.Xresources.asus

    # Xresources.DPI * 1024
    echo "Xft/DPI 98304" > ~/.xsettingsd
    
    bash ~/.screenlayout/asus_hdmi.sh
fi

# Kill xsettingsd to be restarted by i3. Used to scale GTK apps when going 2K <=> 4K
killall -HUP xsettingsd

# Restart i3wm
i3-msg restart
