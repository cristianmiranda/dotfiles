#!/usr/bin/env bash

AIRPODS_MAC='7C:9A:1D:BA:BD:D6'
AIRPODS_NAME='bluez_card.7C_9A_1D_BA_BD_D6'
AIRPODS_SINK='bluez_output.7C_9A_1D_BA_BD_D6'
AIRPODS_SOURCE='bluez_input.7C_9A_1D_BA_BD_D6'

HEADSET_PROFILE='headset-head-unit'
SPEAKER_PROFILE_AAC='a2dp-sink-aac'
SPEAKER_PROFILE_SBC='a2dp-sink-sbc'

SPEAKER_SINK='a2dp-sink'
HEADSET_SINK='headset-head-unit'
HEADSET_SOURCE='headset-head-unit'

if [[ -z "$1" ]]; then
  echo "Usage: $0 <connect | disconnect | headset | speaker>"
  exit 1
fi

connect() {
    bluetooth on
    sleep 3
    bluetoothctl connect $AIRPODS_MAC
    sleep 3
    speaker
}

disconnect() {
    bluetoothctl disconnect $AIRPODS_MAC
}

headset() {
    pactl set-card-profile $AIRPODS_NAME $HEADSET_PROFILE
    sleep 1
    pactl set-default-sink $AIRPODS_SINK.$HEADSET_SINK
    pactl set-default-source $AIRPODS_SOURCE.$HEADSET_SOURCE
}

speaker() {
    pactl set-card-profile $AIRPODS_NAME $SPEAKER_PROFILE_AAC
    sleep 1
    pactl set-default-sink $AIRPODS_SINK.$SPEAKER_SINK
}

case "$1" in
  connect)
    connect
    ;;
  disconnect)
    disconnect
    ;;
  headset)
    headset
    ;;
  speaker)
    speaker
    ;;
esac
